<!DOCTYPE html>
<!--
  SCORM 1.2 Compliant Course
  ==========================
  Course: How We Make Money
  Version: 1.0
  
  This is a self-contained SCORM package that can be uploaded directly to any
  SCORM 1.2 compliant LMS. No external dependencies are required.
  
  SCORM Tracking Logic:
  - Lesson progress is saved using cmi.suspend_data (JSON object)
  - Current position is saved using cmi.core.lesson_location
  - Quiz scores are saved using cmi.core.score.raw
  - Completion status uses cmi.core.lesson_status (passed/failed/incomplete)
  - Session time is tracked automatically via scormdriver.js
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How We Make Money - Stoneridge Training</title>
    <link rel="stylesheet" href="styles.css">
    <script src="scormdriver.js"></script>
</head>
<body>
    <!-- Header with Progress -->
    <header class="header">
        <div class="header-content">
            <div class="header-brand">
                <!-- Logo - place stoneridge-logo.png in assets/ folder -->
                <img src="assets/stoneridge-logo.png" alt="Stoneridge" class="header-logo" onerror="this.style.display='none'">
                <div class="header-title">How We Make Money</div>
            </div>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="progress-text">0% Complete</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <h2 class="sidebar-title">Course Lessons</h2>
            <ul class="lesson-list" id="lesson-list">
                <!-- Lesson buttons generated by JavaScript -->
            </ul>
        </aside>

        <!-- Content Area -->
        <main class="content-area" id="content-area">
            <!-- Content loaded dynamically -->
        </main>
    </div>

    <script>
    /**
     * Course Application
     * ==================
     * This script manages the course UI, navigation, and SCORM communication.
     * 
     * Key Features:
     * - Lesson content rendering
     * - Quiz handling with scoring
     * - Progress tracking and persistence
     * - SCORM data model updates
     */
    (function() {
        'use strict';

        // =====================================================================
        // Course Data - Embedded Lesson Content
        // =====================================================================
        
        /**
         * All lesson content is embedded here to avoid external dependencies.
         * Each lesson contains:
         * - id: Unique identifier
         * - title: Full lesson title
         * - shortTitle: Abbreviated title for sidebar
         * - description: Brief description
         * - sections: Array of content blocks
         * - quiz: Array of quiz questions
         */
        var lessons = [
            {
                id: 1,
                title: "Who We Are",
                shortTitle: "Introduction",
                description: "Meet Stoneridge Software and Levridge ‚Äî two connected companies helping businesses run better.",
                sections: [
                    {
                        type: 'text',
                        content: "At Stoneridge, we help businesses run better using Microsoft technology. We do this through two connected but distinct companies: <strong>Stoneridge Software</strong> and <strong>Levridge</strong>."
                    },
                    {
                        // Audio section - references assets/lesson1-audio.mp3
                        type: 'audio',
                        audioSrc: 'assets/lesson1-audio.mp3',
                        transcript: "At Stoneridge, we help businesses run better using Microsoft technology.\n\nWe do this through two connected but distinct companies: Stoneridge Software and Levridge.\n\nTogether, they support organizations by implementing, extending, and optimizing Microsoft business solutions ‚Äî with a strong focus on industry expertise."
                    },
                    {
                        type: 'accordion',
                        title: "The Two Companies",
                        items: [
                            {
                                title: "Stoneridge Software",
                                content: "A consulting and technology services company focused on Microsoft Dynamics 365 and Microsoft 365 implementations."
                            },
                            {
                                title: "Levridge",
                                content: "An independent software vendor (ISV) that builds specialized software for the agriculture industry on top of Microsoft technology."
                            }
                        ]
                    },
                    {
                        type: 'stats',
                        title: "Key Facts",
                        items: [
                            { label: "Microsoft Partner", icon: "ü§ù" },
                            { label: "Industry-Focused", icon: "üéØ" },
                            { label: "Two Connected Companies", icon: "üè¢" }
                        ]
                    }
                ],
                quiz: [
                    {
                        id: "q1-1",
                        question: "What is the relationship between Stoneridge Software and Levridge?",
                        options: [
                            "They are competitors in the same market",
                            "They are two connected but distinct companies under Stoneridge",
                            "Levridge acquired Stoneridge Software",
                            "They have no relationship"
                        ],
                        correctIndex: 1,
                        feedback: {
                            correct: "Correct! Stoneridge Software and Levridge are two connected but distinct companies that work together to help businesses succeed with Microsoft technology.",
                            incorrect: "Not quite. Stoneridge Software and Levridge are actually two connected but distinct companies ‚Äî both part of the Stoneridge family."
                        }
                    }
                ]
            },
            {
                id: 2,
                title: "Stoneridge Software Overview",
                shortTitle: "Stoneridge Software",
                description: "Learn what Stoneridge Software does and the industries we serve.",
                sections: [
                    {
                        type: 'text',
                        content: "Stoneridge Software is a <strong>consulting and technology services company</strong>. We help businesses implement, customize, and support Microsoft business applications like Dynamics 365 and Microsoft 365."
                    },
                    {
                        type: 'audio',
                        audioSrc: 'assets/lesson2-audio.mp3',
                        transcript: "Stoneridge Software is a consulting and technology services company. We help businesses implement, customize, and support Microsoft business applications like Dynamics 365 and Microsoft 365.\n\nOur role is to ensure these systems are configured correctly so clients can manage accounting, operations, sales, and customer service more effectively. We primarily serve mid-sized organizations across key industries including, but not limited to: Agriculture, Food & Beverage, Specialty Construction, and Industrial Manufacturing."
                    },
                    {
                        type: 'accordion',
                        title: "Industries We Serve",
                        items: [
                            { title: "Agriculture", content: "We support agricultural businesses with specialized solutions for commodity management, grain trading, and farm operations." },
                            { title: "Food & Beverage", content: "From production planning to compliance tracking, we help food and beverage companies streamline their operations." },
                            { title: "Specialty Construction", content: "We serve specialty construction companies with solutions for project management, job costing, and field operations." },
                            { title: "Industrial Manufacturing", content: "We help manufacturers with complex supply chains optimize production and distribution." }
                        ]
                    },
                    {
                        type: 'list',
                        title: "What We Help Clients Manage",
                        items: [
                            "Accounting and financial operations",
                            "Business operations and workflows",
                            "Sales pipeline and customer relationships",
                            "Customer service and support"
                        ]
                    }
                ],
                quiz: [
                    {
                        id: "q2-1",
                        question: "What type of company is Stoneridge Software?",
                        options: [
                            "A hardware manufacturer",
                            "A consulting and technology services company",
                            "A retail company",
                            "A marketing agency"
                        ],
                        correctIndex: 1,
                        feedback: {
                            correct: "That's right! Stoneridge Software is a consulting and technology services company specializing in Microsoft business applications.",
                            incorrect: "Not quite. Stoneridge Software is a consulting and technology services company that helps implement and support Microsoft business applications."
                        }
                    }
                ]
            },
            {
                id: 3,
                title: "How Stoneridge Makes Money",
                shortTitle: "Stoneridge Revenue",
                description: "Understand the primary revenue streams that power Stoneridge Software.",
                sections: [
                    {
                        type: 'text',
                        content: "Understanding how we generate revenue helps everyone appreciate the business model and make better decisions. Let's explore Stoneridge Software's main revenue streams."
                    },
                    {
                        type: 'audio',
                        audioSrc: 'assets/lesson3-audio.mp3',
                        transcript: "The majority of Stoneridge's revenue comes from consulting services. Clients pay us for the time and expertise of our consultants through either time-and-materials or subscription-based arrangements.\n\nThis includes: Software implementations, ongoing system support, and project work delivered by Stoneridge consultants or subcontractors."
                    },
                    {
                        type: 'accordion',
                        title: "Revenue Streams",
                        items: [
                            { title: "Consulting Revenue (Primary)", content: "The majority of Stoneridge's revenue comes from consulting services. Clients pay us for the time and expertise of our consultants through either time-and-materials or subscription-based arrangements. This includes software implementations, ongoing system support, and project work." },
                            { title: "Product Licensing Resale", content: "As a Microsoft partner, Stoneridge purchases software licenses from Microsoft and other third-party vendors, applies a markup, and resells them to clients. This is a growing revenue stream for the company." },
                            { title: "Partner Incentives", content: "We receive partner incentives from Microsoft for selling licenses and completing qualifying activities. These incentives reward us for growing the Microsoft ecosystem." }
                        ]
                    },
                    {
                        type: 'comparison',
                        title: "Revenue Model Summary",
                        left: { title: "Time & Materials", description: "Clients pay for actual hours worked" },
                        right: { title: "Subscription Support", description: "Clients pay recurring fees for ongoing support" }
                    },
                    {
                        type: 'highlight',
                        content: "Key insight: As a consulting business, our revenue is directly tied to the time and expertise of our people."
                    }
                ],
                quiz: [
                    {
                        id: "q3-1",
                        question: "What is Stoneridge Software's PRIMARY source of revenue?",
                        options: [
                            "Advertising",
                            "Product manufacturing",
                            "Consulting services",
                            "Real estate"
                        ],
                        correctIndex: 2,
                        feedback: {
                            correct: "Exactly! Consulting services ‚Äî where clients pay for our expertise and time ‚Äî is the primary revenue source for Stoneridge Software.",
                            incorrect: "Actually, consulting services are Stoneridge's primary revenue source. Clients pay for our expertise through time-and-materials or subscription arrangements."
                        }
                    }
                ]
            },
            {
                id: 4,
                title: "Stoneridge Cost Structure",
                shortTitle: "Stoneridge Costs",
                description: "Learn about the major cost drivers for a consulting business like Stoneridge.",
                sections: [
                    {
                        type: 'text',
                        content: "Every business has costs that enable it to operate and deliver value. For a consulting company like Stoneridge Software, understanding our cost structure helps explain business decisions."
                    },
                    {
                        type: 'audio',
                        audioSrc: 'assets/lesson4-audio.mp3',
                        transcript: "Because Stoneridge is a consulting and services-based business, our largest costs are tied directly to the people, tools, and systems required to deliver value to our clients.\n\nThe first and largest cost category is salaries and benefits for consultants and subcontractors. These are the teams who do the work for our clients ‚Äî including project managers, solution architects, developers, data specialists, and trainers."
                    },
                    {
                        type: 'accordion',
                        title: "Major Cost Categories",
                        items: [
                            { title: "People Costs", content: "Salaries and benefits for consultants and subcontractors represent the largest expense. As a people-driven business, our team IS our product." },
                            { title: "License Costs", content: "We purchase Microsoft and third-party licenses that we then resell to clients. These costs are offset by the markup we apply." },
                            { title: "Operational Costs", content: "Internal teams, tools, marketing, training, and office expenses all contribute to running the business effectively." }
                        ]
                    },
                    {
                        type: 'highlight',
                        content: "This cost structure reflects a people-driven consulting business. Our biggest investment is in talented people who deliver value to clients."
                    },
                    {
                        type: 'stats',
                        title: "Cost Categories at a Glance",
                        items: [
                            { label: "People", icon: "üë•", description: "Salaries & benefits" },
                            { label: "Licenses", icon: "üîë", description: "Software costs" },
                            { label: "Operations", icon: "‚öôÔ∏è", description: "Tools & overhead" }
                        ]
                    }
                ],
                quiz: [
                    {
                        id: "q4-1",
                        question: "What is the largest expense category for Stoneridge Software?",
                        options: [
                            "Marketing and advertising",
                            "Office buildings",
                            "Salaries and benefits for consultants",
                            "Software development"
                        ],
                        correctIndex: 2,
                        feedback: {
                            correct: "Correct! As a consulting company, people are our greatest asset and our largest expense. Salaries and benefits for consultants represent the biggest cost.",
                            incorrect: "Not quite. Since Stoneridge is a consulting company, our biggest expense is people ‚Äî specifically salaries and benefits for our consultants."
                        }
                    }
                ]
            },
            {
                id: 5,
                title: "Why Levridge Exists",
                shortTitle: "Levridge Origins",
                description: "Discover why Stoneridge created Levridge and its purpose in the market.",
                sections: [
                    {
                        type: 'text',
                        content: "Levridge is a <strong>software development company</strong> and <strong>independent software vendor (ISV)</strong>. But why did Stoneridge create a separate company?"
                    },
                    {
                        type: 'audio',
                        audioSrc: 'assets/lesson5-audio.mp3',
                        transcript: "Levridge is a software development company and independent software vendor, or ISV. Stoneridge founded Levridge in 2018 as a strategic move to strengthen our agriculture industry focus. At the time, existing Microsoft solutions didn't fully meet the needs of agribusinesses ‚Äî so we built something purpose-designed.\n\nLevridge is a cloud-based platform built on Dynamics 365, with specialized features like: Commodity accounting, grain trading, agronomy, and patronage tracking."
                    },
                    {
                        type: 'text',
                        content: "Stoneridge founded Levridge in 2018 as a strategic move to strengthen our agriculture industry focus. At the time, existing Microsoft solutions didn't fully meet the needs of agribusinesses ‚Äî so we built something purpose-designed."
                    },
                    {
                        type: 'list',
                        title: "Levridge Key Features",
                        items: [
                            "Commodity accounting",
                            "Grain trading",
                            "Agronomy management",
                            "Patronage tracking"
                        ]
                    },
                    {
                        type: 'comparison',
                        title: "A Helpful Analogy",
                        left: { title: "Stoneridge Software", description: "Builds and customizes the house using Microsoft materials" },
                        right: { title: "Levridge", description: "The custom-designed kitchen built specifically for farmers" }
                    }
                ],
                quiz: [
                    {
                        id: "q5-1",
                        question: "When was Levridge founded and why?",
                        options: [
                            "2010, to compete with Microsoft",
                            "2018, to address unmet needs in the agriculture industry",
                            "2020, to expand into retail",
                            "2015, to replace Stoneridge Software"
                        ],
                        correctIndex: 1,
                        feedback: {
                            correct: "That's right! Levridge was founded in 2018 because existing Microsoft solutions didn't fully meet the specialized needs of agribusinesses.",
                            incorrect: "Levridge was actually founded in 2018 as a strategic move to address the unique needs of agricultural businesses that weren't being met by existing solutions."
                        }
                    }
                ]
            },
            {
                id: 6,
                title: "How Levridge Makes Money",
                shortTitle: "Levridge Revenue",
                description: "Understand Levridge's revenue model as a SaaS-style product company.",
                sections: [
                    {
                        type: 'text',
                        content: "Unlike Stoneridge Software's consulting model, Levridge operates more like a <strong>SaaS (Software as a Service)</strong> company. Let's explore how this different model generates revenue."
                    },
                    {
                        type: 'audio',
                        audioSrc: 'assets/lesson6-audio.mp3',
                        transcript: "Unlike Stoneridge Software's consulting model, Levridge operates more like a SaaS ‚Äî Software as a Service ‚Äî company. Let's explore how this different model generates revenue.\n\nLevridge's core revenue comes from subscription licensing. Clients pay recurring fees to access and use the platform ‚Äî similar to how you might subscribe to Netflix or Microsoft 365."
                    },
                    {
                        type: 'accordion',
                        title: "Levridge Revenue Streams",
                        items: [
                            { title: "Subscription Revenue (Primary)", content: "Levridge's core revenue comes from subscription licensing. Clients pay recurring fees to access and use the platform ‚Äî similar to how you might subscribe to Netflix or Microsoft 365. As more agribusinesses adopt Levridge, this recurring revenue grows." },
                            { title: "Feature & Add-On Revenue", content: "Levridge also generates revenue through add-on features and enhancements. These may include advanced integrations or specialized workflows requested by clients. These are typically one-time or project-based fees on top of the base subscription." },
                            { title: "Consulting Revenue", content: "While primarily a product company, Levridge also earns consulting revenue ‚Äî especially for onboarding, configuration, and training. This work often happens in close collaboration with Stoneridge Software." }
                        ]
                    },
                    {
                        type: 'highlight',
                        content: "Key difference: Subscription revenue is recurring and predictable, making it easier to plan for the future. Each new customer adds to a growing base of monthly revenue."
                    },
                    {
                        type: 'comparison',
                        title: "Comparing Revenue Models",
                        left: { title: "Stoneridge (Consulting)", description: "Revenue tied to billable hours and project work" },
                        right: { title: "Levridge (Product/SaaS)", description: "Recurring subscription fees that grow over time" }
                    }
                ],
                quiz: [
                    {
                        id: "q6-1",
                        question: "What is Levridge's PRIMARY source of revenue?",
                        options: [
                            "One-time software sales",
                            "Subscription licensing fees",
                            "Hardware sales",
                            "Advertising"
                        ],
                        correctIndex: 1,
                        feedback: {
                            correct: "Correct! Levridge's core revenue comes from subscription licensing ‚Äî recurring fees clients pay to access and use the platform.",
                            incorrect: "Actually, Levridge primarily earns revenue through subscription licensing ‚Äî recurring fees that clients pay on an ongoing basis."
                        }
                    }
                ]
            },
            {
                id: 7,
                title: "Levridge Today and Strategic Direction",
                shortTitle: "Levridge Strategy",
                description: "See how Levridge is evolving and growing within the Microsoft partner ecosystem.",
                sections: [
                    {
                        type: 'text',
                        content: "As Levridge has matured, the company has been evolving to operate more independently as a true ISV (Independent Software Vendor)."
                    },
                    {
                        type: 'audio',
                        audioSrc: 'assets/lesson7-audio.mp3',
                        transcript: "As Levridge has matured, the company has been evolving to operate more independently as a true ISV ‚Äî Independent Software Vendor.\n\nThis strategic evolution includes operating more independently with dedicated leadership, expanding reach beyond Stoneridge clients, and building partnerships across the Microsoft ecosystem."
                    },
                    {
                        type: 'list',
                        title: "Strategic Evolution",
                        items: [
                            "Operating more independently as a true ISV",
                            "Leadership focused specifically on Levridge's growth",
                            "Expanding reach beyond Stoneridge clients",
                            "Building partnerships across the Microsoft ecosystem"
                        ]
                    },
                    {
                        type: 'text',
                        content: "This allows Levridge to scale its impact across the agriculture industry while remaining deeply connected to Microsoft's platform."
                    },
                    {
                        type: 'stats',
                        title: "Levridge's Growth Strategy",
                        items: [
                            { label: "Independence", icon: "üöÄ", description: "Operating as a true ISV" },
                            { label: "Scale", icon: "üìà", description: "Growing customer base" },
                            { label: "Ecosystem", icon: "üåê", description: "Microsoft partner network" }
                        ]
                    }
                ],
                quiz: [
                    {
                        id: "q7-1",
                        question: "How is Levridge evolving as a company?",
                        options: [
                            "It's merging completely into Stoneridge Software",
                            "It's operating more independently as a true ISV with its own leadership",
                            "It's shutting down operations",
                            "It's moving away from Microsoft technology"
                        ],
                        correctIndex: 1,
                        feedback: {
                            correct: "Exactly! Levridge is evolving to operate more independently as a true ISV, with its own CEO and a strategy to serve the broader Microsoft partner ecosystem.",
                            incorrect: "Actually, Levridge is evolving to operate more independently with dedicated leadership, positioning itself to serve the broader Microsoft partner ecosystem."
                        }
                    }
                ]
            },
            {
                id: 8,
                title: "Summary and Mental Model",
                shortTitle: "Summary",
                description: "Bring it all together with a clear mental model of how Stoneridge and Levridge work.",
                sections: [
                    {
                        type: 'text',
                        content: "Let's wrap up with a clear mental model for understanding our two companies."
                    },
                    {
                        type: 'comparison',
                        title: "The Simple Summary",
                        left: { title: "Stoneridge Software", description: "The expert team that implements and supports Microsoft business solutions" },
                        right: { title: "Levridge", description: "The specialized agriculture solution built on top of Microsoft tools" }
                    },
                    {
                        type: 'highlight',
                        content: "Think of it this way: Stoneridge builds and customizes the house using Microsoft materials. Levridge is the custom-designed kitchen built specifically for farmers."
                    },
                    {
                        type: 'accordion',
                        title: "Key Takeaways",
                        items: [
                            { title: "Two Different Business Models", content: "Stoneridge Software is a consulting business (revenue from billable time). Levridge is a product/SaaS business (revenue from subscriptions)." },
                            { title: "Connected But Distinct", content: "While they work closely together, each company has its own focus, leadership, and growth strategy." },
                            { title: "Industry Expertise", content: "Both companies share a commitment to deep industry knowledge, particularly in agriculture, food & beverage, and manufacturing." },
                            { title: "Microsoft Partnership", content: "Both companies operate within and contribute to the Microsoft partner ecosystem." }
                        ]
                    },
                    {
                        type: 'text',
                        content: "Together, they help clients operate smarter, scale faster, and get more value from their technology investments."
                    }
                ],
                quiz: [] // No quiz for final lesson - just completion
            }
        ];

        // =====================================================================
        // Application State
        // =====================================================================
        
        var state = {
            currentLesson: 1,        // Current lesson being viewed
            lessonsCompleted: [],    // Array of completed lesson IDs
            quizScores: {},          // Object mapping lesson ID to score
            viewState: 'content',    // 'content', 'quiz', or 'complete'
            currentQuizIndex: 0,     // Current question in quiz
            quizAnswers: [],         // User's answers for current quiz
            totalScore: 0            // Overall course score
        };

        // =====================================================================
        // DOM Elements
        // =====================================================================
        
        var elements = {
            lessonList: document.getElementById('lesson-list'),
            contentArea: document.getElementById('content-area'),
            progressFill: document.getElementById('progress-fill'),
            progressText: document.getElementById('progress-text')
        };

        // =====================================================================
        // Initialization
        // =====================================================================
        
        /**
         * Initialize the application.
         * Loads saved progress from SCORM and renders the UI.
         */
        function init() {
            // Load saved progress from SCORM
            loadProgress();
            
            // Render the sidebar
            renderSidebar();
            
            // Render the current lesson
            renderLesson(state.currentLesson);
            
            // Update progress display
            updateProgress();
        }

        /**
         * Load progress from SCORM suspend_data.
         * This restores the user's position and completed lessons.
         */
        function loadProgress() {
            var savedProgress = SCORM.loadProgress();
            
            // Restore location (current lesson)
            if (savedProgress.location) {
                var lessonId = parseInt(savedProgress.location, 10);
                if (lessonId >= 1 && lessonId <= lessons.length) {
                    state.currentLesson = lessonId;
                }
            }
            
            // Restore additional data
            if (savedProgress.data) {
                state.lessonsCompleted = savedProgress.data.lessonsCompleted || [];
                state.quizScores = savedProgress.data.quizScores || {};
                state.totalScore = savedProgress.data.totalScore || 0;
            }
            
            console.log('[Course] Loaded progress:', state);
        }

        /**
         * Save progress to SCORM.
         * Called whenever the user completes a lesson or navigates.
         */
        function saveProgress() {
            var data = {
                lessonsCompleted: state.lessonsCompleted,
                quizScores: state.quizScores,
                totalScore: state.totalScore
            };
            
            // Save to SCORM
            // cmi.core.lesson_location = current lesson ID
            // cmi.suspend_data = JSON object with progress details
            SCORM.saveProgress(state.currentLesson.toString(), data);
            
            console.log('[Course] Saved progress:', data);
        }

        // =====================================================================
        // UI Rendering
        // =====================================================================
        
        /**
         * Render the sidebar lesson list.
         */
        function renderSidebar() {
            var html = '';
            
            lessons.forEach(function(lesson, index) {
                var isCompleted = state.lessonsCompleted.indexOf(lesson.id) !== -1;
                var isActive = state.currentLesson === lesson.id;
                var classes = ['lesson-button'];
                
                if (isCompleted) classes.push('completed');
                if (isActive) classes.push('active');
                
                html += '<li class="lesson-item">' +
                    '<button class="' + classes.join(' ') + '" ' +
                    'data-lesson="' + lesson.id + '" ' +
                    'data-num="' + lesson.id + '">' +
                    lesson.shortTitle +
                    '</button>' +
                    '</li>';
            });
            
            elements.lessonList.innerHTML = html;
            
            // Add click handlers
            var buttons = elements.lessonList.querySelectorAll('.lesson-button');
            buttons.forEach(function(button) {
                button.addEventListener('click', function() {
                    var lessonId = parseInt(this.getAttribute('data-lesson'), 10);
                    navigateToLesson(lessonId);
                });
            });
        }

        /**
         * Render a lesson's content.
         * 
         * @param {number} lessonId - ID of the lesson to render
         */
        function renderLesson(lessonId) {
            var lesson = lessons.find(function(l) { return l.id === lessonId; });
            if (!lesson) return;
            
            state.currentLesson = lessonId;
            state.viewState = 'content';
            
            var html = '';
            
            // Lesson header
            html += '<div class="lesson-header">' +
                '<span class="lesson-badge">Lesson ' + lesson.id + '</span>' +
                '<h1 class="lesson-title">' + lesson.title + '</h1>' +
                '<p class="lesson-description">' + lesson.description + '</p>' +
                '</div>';
            
            // Lesson content sections
            lesson.sections.forEach(function(section) {
                html += renderSection(section);
            });
            
            // Action button
            html += '<div class="lesson-nav">' +
                '<div>';
            
            if (lessonId > 1) {
                html += '<button class="btn btn-outline" id="btn-previous">‚Üê Previous</button>';
            }
            
            html += '</div><div>';
            
            // For the last lesson with no quiz, show "Complete Course"
            // For other lessons, show "Take Knowledge Check"
            if (lesson.quiz.length === 0) {
                html += '<button class="btn btn-accent btn-lg" id="btn-complete-course">üèÜ Complete Course</button>';
            } else {
                html += '<button class="btn btn-primary btn-lg" id="btn-start-quiz">Take Knowledge Check ‚Üí</button>';
            }
            
            html += '</div></div>';
            
            elements.contentArea.innerHTML = html;
            
            // Add event listeners
            var prevBtn = document.getElementById('btn-previous');
            if (prevBtn) {
                prevBtn.addEventListener('click', function() {
                    navigateToLesson(lessonId - 1);
                });
            }
            
            var quizBtn = document.getElementById('btn-start-quiz');
            if (quizBtn) {
                quizBtn.addEventListener('click', function() {
                    startQuiz(lesson);
                });
            }
            
            var completeBtn = document.getElementById('btn-complete-course');
            if (completeBtn) {
                completeBtn.addEventListener('click', function() {
                    completeCourse();
                });
            }
            
            // Initialize accordions
            initAccordions();
            
            // Update sidebar
            renderSidebar();
            
            // Save progress
            saveProgress();
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        /**
         * Render a content section based on its type.
         * 
         * @param {Object} section - Section data
         * @returns {string} - HTML string
         */
        function renderSection(section) {
            var html = '<div class="content-section">';
            // Unique ID for audio/transcript elements
            var uniqueId = 'section-' + Math.random().toString(36).substr(2, 9);
            
            switch (section.type) {
                case 'text':
                    html += '<div class="text-content">' + section.content + '</div>';
                    break;
                
                // Audio section - renders an audio player with optional transcript
                case 'audio':
                    html += '<div class="audio-section">' +
                        '<div class="audio-header">' +
                        '<div class="audio-icon">üéß</div>' +
                        '<span class="audio-label">Listen to Audio</span>' +
                        '</div>' +
                        '<audio controls class="audio-player" preload="metadata">' +
                        '<source src="' + section.audioSrc + '" type="audio/mpeg">' +
                        'Your browser does not support the audio element.' +
                        '</audio>';
                    
                    // Add transcript toggle if available
                    if (section.transcript) {
                        html += '<button class="transcript-toggle" onclick="toggleTranscript(\'' + uniqueId + '\')">' +
                            'üìÑ Show Transcript' +
                            '</button>' +
                            '<div id="transcript-' + uniqueId + '" class="transcript-content">' +
                            section.transcript +
                            '</div>';
                    }
                    html += '</div>';
                    break;
                
                // Image section - renders an image with optional caption
                case 'image':
                    html += '<figure>' +
                        '<img src="' + section.src + '" alt="' + (section.alt || '') + '" class="reference-image">' +
                        (section.caption ? '<figcaption class="image-caption">' + section.caption + '</figcaption>' : '') +
                        '</figure>';
                    break;
                    
                case 'highlight':
                    html += '<div class="highlight-box"><p>' + section.content + '</p></div>';
                    break;
                    
                case 'list':
                    if (section.title) {
                        html += '<h3 class="section-title">' + section.title + '</h3>';
                    }
                    html += '<ul class="content-list">';
                    section.items.forEach(function(item) {
                        html += '<li>' + item + '</li>';
                    });
                    html += '</ul>';
                    break;
                    
                case 'accordion':
                    if (section.title) {
                        html += '<h3 class="section-title">' + section.title + '</h3>';
                    }
                    html += '<div class="accordion">';
                    section.items.forEach(function(item, index) {
                        html += '<div class="accordion-item">' +
                            '<button class="accordion-header">' + item.title + '</button>' +
                            '<div class="accordion-content">' + item.content + '</div>' +
                            '</div>';
                    });
                    html += '</div>';
                    break;
                    
                case 'comparison':
                    if (section.title) {
                        html += '<h3 class="section-title">' + section.title + '</h3>';
                    }
                    html += '<div class="comparison">' +
                        '<div class="comparison-card">' +
                        '<h4>' + section.left.title + '</h4>' +
                        '<p>' + section.left.description + '</p>' +
                        '</div>' +
                        '<div class="comparison-card">' +
                        '<h4>' + section.right.title + '</h4>' +
                        '<p>' + section.right.description + '</p>' +
                        '</div>' +
                        '</div>';
                    break;
                    
                case 'stats':
                    if (section.title) {
                        html += '<h3 class="section-title">' + section.title + '</h3>';
                    }
                    html += '<div class="stats-grid">';
                    section.items.forEach(function(item) {
                        html += '<div class="stat-card">' +
                            '<div class="stat-icon">' + item.icon + '</div>' +
                            '<div class="stat-label">' + item.label + '</div>' +
                            (item.description ? '<div class="stat-description">' + item.description + '</div>' : '') +
                            '</div>';
                    });
                    html += '</div>';
                    break;
            }
            
            html += '</div>';
            return html;
        }
        
        /**
         * Toggle transcript visibility.
         * Called by onclick handler on transcript buttons.
         * 
         * @param {string} id - Unique ID of the transcript element
         */
        function toggleTranscript(id) {
            var transcript = document.getElementById('transcript-' + id);
            var button = transcript.previousElementSibling;
            if (transcript.classList.contains('open')) {
                transcript.classList.remove('open');
                button.innerHTML = 'üìÑ Show Transcript';
            } else {
                transcript.classList.add('open');
                button.innerHTML = 'üìÑ Hide Transcript';
            }
        }
        // Expose toggleTranscript globally for onclick handlers
        window.toggleTranscript = toggleTranscript;

        /**
         * Initialize accordion functionality.
         */
        function initAccordions() {
            var headers = document.querySelectorAll('.accordion-header');
            headers.forEach(function(header) {
                header.addEventListener('click', function() {
                    var item = this.parentElement;
                    item.classList.toggle('open');
                });
            });
        }

        // =====================================================================
        // Quiz Handling
        // =====================================================================
        
        /**
         * Start the quiz for a lesson.
         * 
         * @param {Object} lesson - Lesson data
         */
        function startQuiz(lesson) {
            state.viewState = 'quiz';
            state.currentQuizIndex = 0;
            state.quizAnswers = [];
            
            renderQuizQuestion(lesson, 0);
        }

        /**
         * Render a quiz question.
         * 
         * @param {Object} lesson - Lesson data
         * @param {number} questionIndex - Index of the question
         */
        function renderQuizQuestion(lesson, questionIndex) {
            var question = lesson.quiz[questionIndex];
            var totalQuestions = lesson.quiz.length;
            
            var html = '<div class="quiz-container">' +
                '<div class="quiz-progress">' +
                '<div class="quiz-progress-text">Question ' + (questionIndex + 1) + ' of ' + totalQuestions + '</div>' +
                '</div>' +
                '<div class="quiz-question">' + question.question + '</div>' +
                '<div class="quiz-options">';
            
            var letters = ['A', 'B', 'C', 'D'];
            question.options.forEach(function(option, index) {
                html += '<label class="quiz-option" data-index="' + index + '">' +
                    '<input type="radio" name="quiz-answer" value="' + index + '">' +
                    '<span class="quiz-option-marker">' + letters[index] + '</span>' +
                    '<span class="quiz-option-text">' + option + '</span>' +
                    '</label>';
            });
            
            html += '</div>' +
                '<div id="quiz-feedback" class="hidden"></div>' +
                '<div class="lesson-nav">' +
                '<div></div>' +
                '<button class="btn btn-primary" id="btn-submit-answer" disabled>Submit Answer</button>' +
                '</div>' +
                '</div>';
            
            elements.contentArea.innerHTML = html;
            
            // Add event listeners
            var options = document.querySelectorAll('.quiz-option');
            var submitBtn = document.getElementById('btn-submit-answer');
            var selectedIndex = null;
            
            options.forEach(function(option) {
                option.addEventListener('click', function() {
                    // Clear previous selection
                    options.forEach(function(o) { o.classList.remove('selected'); });
                    
                    // Select this option
                    this.classList.add('selected');
                    this.querySelector('input').checked = true;
                    selectedIndex = parseInt(this.getAttribute('data-index'), 10);
                    
                    // Enable submit button
                    submitBtn.disabled = false;
                });
            });
            
            submitBtn.addEventListener('click', function() {
                if (selectedIndex === null) return;
                
                // Disable further selection
                options.forEach(function(o) { 
                    o.style.pointerEvents = 'none'; 
                });
                
                // Show correct/incorrect
                var isCorrect = selectedIndex === question.correctIndex;
                options.forEach(function(option, index) {
                    if (index === question.correctIndex) {
                        option.classList.add('correct');
                    } else if (index === selectedIndex) {
                        option.classList.add('incorrect');
                    }
                });
                
                // Save answer
                state.quizAnswers.push({
                    questionId: question.id,
                    selectedIndex: selectedIndex,
                    correct: isCorrect
                });
                
                // Show feedback
                var feedbackEl = document.getElementById('quiz-feedback');
                feedbackEl.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
                feedbackEl.innerHTML = '<div class="quiz-feedback-title">' + 
                    (isCorrect ? '‚úì Correct!' : '‚úó Incorrect') + '</div>' +
                    '<p>' + (isCorrect ? question.feedback.correct : question.feedback.incorrect) + '</p>';
                
                // Change button to continue
                submitBtn.textContent = questionIndex < lesson.quiz.length - 1 ? 'Next Question ‚Üí' : 'See Results';
                submitBtn.onclick = function() {
                    if (questionIndex < lesson.quiz.length - 1) {
                        renderQuizQuestion(lesson, questionIndex + 1);
                    } else {
                        completeLesson(lesson);
                    }
                };
            });
            
            window.scrollTo(0, 0);
        }

        /**
         * Complete a lesson after finishing the quiz.
         * Calculates score and updates SCORM.
         * 
         * @param {Object} lesson - Lesson data
         */
        function completeLesson(lesson) {
            // Calculate score for this lesson
            var correctAnswers = state.quizAnswers.filter(function(a) { return a.correct; }).length;
            var totalQuestions = lesson.quiz.length;
            var score = Math.round((correctAnswers / totalQuestions) * 100);
            
            // Save lesson score
            state.quizScores[lesson.id] = score;
            
            // Mark lesson as completed
            if (state.lessonsCompleted.indexOf(lesson.id) === -1) {
                state.lessonsCompleted.push(lesson.id);
            }
            
            // Calculate overall score
            var totalScore = 0;
            var scoredLessons = 0;
            Object.keys(state.quizScores).forEach(function(key) {
                totalScore += state.quizScores[key];
                scoredLessons++;
            });
            state.totalScore = scoredLessons > 0 ? Math.round(totalScore / scoredLessons) : 0;
            
            // Save progress
            saveProgress();
            
            // Update progress display
            updateProgress();
            
            // Check if course is complete
            if (state.lessonsCompleted.length === lessons.length) {
                // All lessons completed - mark course as complete in SCORM
                // Set score and status (passed if score >= 80, otherwise failed)
                SCORM.setScore(state.totalScore, 80);
                showCourseComplete();
            } else {
                // Show lesson complete screen
                showLessonComplete(lesson, score);
            }
        }

        /**
         * Complete the course (for final lesson without quiz).
         */
        function completeCourse() {
            var lesson = lessons[lessons.length - 1];
            
            // Mark final lesson as completed
            if (state.lessonsCompleted.indexOf(lesson.id) === -1) {
                state.lessonsCompleted.push(lesson.id);
            }
            
            // Save progress
            saveProgress();
            
            // Calculate final score from all quizzes
            var totalScore = 0;
            var scoredLessons = 0;
            Object.keys(state.quizScores).forEach(function(key) {
                totalScore += state.quizScores[key];
                scoredLessons++;
            });
            state.totalScore = scoredLessons > 0 ? Math.round(totalScore / scoredLessons) : 100;
            
            // Set SCORM score and status
            SCORM.setScore(state.totalScore, 80);
            
            // Show completion screen
            showCourseComplete();
        }

        /**
         * Show the lesson completion screen.
         * 
         * @param {Object} lesson - Completed lesson
         * @param {number} score - Quiz score
         */
        function showLessonComplete(lesson, score) {
            var nextLesson = lessons.find(function(l) { return l.id === lesson.id + 1; });
            
            var html = '<div class="completion-screen">' +
                '<div class="completion-icon">‚úì</div>' +
                '<h2 class="completion-title">Lesson Complete!</h2>' +
                '<p class="completion-subtitle">You\'ve completed ' + lesson.title + '</p>' +
                '<div class="completion-score">' +
                '<div class="completion-score-value">' + score + '%</div>' +
                '<div class="completion-score-label">Quiz Score</div>' +
                '</div>' +
                '<div class="lesson-nav" style="justify-content: center; border: none; padding-top: 0;">' +
                '<button class="btn btn-outline" id="btn-review">Review Content</button>';
            
            if (nextLesson) {
                html += '<button class="btn btn-primary" id="btn-next">Next Lesson ‚Üí</button>';
            }
            
            html += '</div></div>';
            
            elements.contentArea.innerHTML = html;
            
            // Update sidebar
            renderSidebar();
            
            // Update progress
            updateProgress();
            
            // Add event listeners
            document.getElementById('btn-review').addEventListener('click', function() {
                renderLesson(lesson.id);
            });
            
            var nextBtn = document.getElementById('btn-next');
            if (nextBtn && nextLesson) {
                nextBtn.addEventListener('click', function() {
                    navigateToLesson(nextLesson.id);
                });
            }
        }

        /**
         * Show the course completion screen.
         * This is shown when all lessons are completed.
         */
        function showCourseComplete() {
            var passed = state.totalScore >= 80;
            
            var html = '<div class="completion-screen">' +
                '<div class="completion-icon" style="background: ' + (passed ? 'var(--success)' : 'var(--accent)') + '">üèÜ</div>' +
                '<h2 class="completion-title">Course Complete!</h2>' +
                '<p class="completion-subtitle">Congratulations! You\'ve completed "How We Make Money"</p>' +
                '<div class="completion-score">' +
                '<div class="completion-score-value">' + state.totalScore + '%</div>' +
                '<div class="completion-score-label">Final Score' + (passed ? ' - Passed!' : '') + '</div>' +
                '</div>' +
                '<p style="color: var(--text-secondary); margin-bottom: var(--spacing-xl);">' +
                'You can review any lesson by clicking on it in the sidebar.' +
                '</p>' +
                '</div>';
            
            elements.contentArea.innerHTML = html;
            
            // Update sidebar
            renderSidebar();
            
            // Update progress
            updateProgress();
        }

        // =====================================================================
        // Navigation & Progress
        // =====================================================================
        
        /**
         * Navigate to a specific lesson.
         * 
         * @param {number} lessonId - ID of the lesson to navigate to
         */
        function navigateToLesson(lessonId) {
            if (lessonId < 1 || lessonId > lessons.length) return;
            
            state.currentLesson = lessonId;
            renderLesson(lessonId);
        }

        /**
         * Update the progress bar and text.
         */
        function updateProgress() {
            var completedCount = state.lessonsCompleted.length;
            var totalLessons = lessons.length;
            var percentage = Math.round((completedCount / totalLessons) * 100);
            
            elements.progressFill.style.width = percentage + '%';
            elements.progressText.textContent = percentage + '% Complete';
        }

        // =====================================================================
        // Start the Application
        // =====================================================================
        
        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
    </script>
</body>
</html>